# pages/findings.py
from dash import html, dcc
from app import dash

dash.register_page(__name__, path="/findings")

layout = html.Div(className="page-container findings-page", children=[

    # Page title
    html.H2("Major Findings for EV Growth", className="section-title"),

    # 1) EV Sales (IEA)
    html.Div(className="findings-section", children=[
        html.H3("EV Sales in USA (IEA)", className="subsection-title"),
        html.Div(className="media-wrapper", children=[
            html.Img(
                src="https://storage.googleapis.com/evenergy163.appspot.com/new_results/EV_sales_USA_2010-2023IEA.png",
                className="full-image"
            ),
            html.Div(className="findings-text", children=[
                "In this plot generated by ",
                html.A(
                    "IEA",
                    href="https://www.iea.org/data-and-statistics/data-tools/global-ev-data-explorer",
                    target="_blank",
                    className="source-link"
                ),
                ", we can see that the number of EV sales has grown exponentially over the years in the USA."
            ])
        ])
    ]),

    # 2) US EV Energy History
html.Div(className="findings-section", children=[

    # Section subtitle + side-by-side panels
    html.H3("United States EV Energy History", className="subsection-title"),
    html.Div(className="media-wrapper", children=[
        html.Img(
            src="https://storage.googleapis.com/evenergy163.appspot.com/new_results/global%20energy%20usage%20history.png",
            className="half-image"
        ),
        html.Img(
            src="https://storage.googleapis.com/evenergy163.appspot.com/new_results/global%20charging%20session%20history.png",
            className="half-image"
        )
    ]),
    html.Div(className="findings-text", children=[
        "Summary: The left plot shows energy usage history; the right plot shows charging session history."
    ]),

# Combined plot with title *above* the graph
html.Div(
    className="media-wrapper",
    style={'flexDirection': 'column'},
    children=[
        html.H4(
            "Charging Sessions vs. Energy Usage Over Time",
            className="subsection-title",
            style={'marginBottom': '1rem', 'textAlign': 'left'}
        ),
        html.Img(
            src="https://storage.googleapis.com/evenergy163.appspot.com/new_results/global%20charging%20session%20and%20energy%20usage%20history.png",
            className="full-image"
        )
    ]
),
html.Div(
    className="findings-text",
    children=[
        "Summary: This plot compares the energy usage and charging session history. "
           "Though they look similar in the 2 plots above, the amount of energy usage is "
           "much higher than the amount of charging sessions. We can see that the energy "
           "usage has increased. Using a linear regression model, we found both charging sessions "
           "and energy usage has an linear growth (confirmed by linear regression with r2 score of 0.902 "
           "and 0.909 respectively). Charging sessions had an avg monthly growth rate of 35.61% while energy increased "
           "by 41.71% each month."
    ]
),


]),
    # 3) Pacific region analysis
    html.Div(className="findings-section", children=[

        html.H3("Further Analysis in the Pacific Region", className="subsection-title"),

        # Chart
        html.Div(className="media-wrapper", children=[
            html.Img(
                src="https://storage.googleapis.com/evenergy163.appspot.com/new_results/pacific_results/pacific_charging_and_energy_usage.png",
                className="full-image"
            )
        ]),

        # Centered Info line, tight to the chart
        html.P(
            "(Info: History of charging sessions and energy usage in the Pacific region.)",
            className="info-text"
        ),

        # Summary text
        html.Div(className="findings-text", children=[
            "Summary: This plot focuses on comparing charging sessions and energy usage in the Pacific region. "
            "Something interesting we found, is that the pacific region has an exponential growth rate, where the exponential "
            "model has an r2 score of 0.9, compared to the linear model with an r2 score of 0.8. This means that the exponential model "
            "fitted better than the linear regression model. While the monthly growth rates we got for charging was around 2.59% and 3.51% "
            "for energy usage."
        ])

    ]),


    # 4) Popular charging locations
html.Div(className="findings-section", children=[

    html.H3("Popular Charging Locations in the Pacific Region", className="subsection-title"),

    # 4a) Top locations bar chart
    html.Div(className="media-wrapper", children=[
        html.Img(
            src="https://storage.googleapis.com/evenergy163.appspot.com/new_results/pacific_results/pacific_top_charging_locations.png",
            className="full-image"
        )
    ]),
    html.P(
        "(Info: Charging session counts by location.)",
        className="info-text"
    ),
    html.Div(className="findings-text", children=[
        "Summary: The plot shows that the amount of charging session is increasing over time. "
           "This can highlight the most popular charging locations in the Pacific region. "
           "We can see that the most popular location at the end of 2022 is around the oregon and "
           "washington area in portland-vancouvr-hillsboro. The second most popular location however "
           "is undesigned, which meant the location was obscured for anonymization purposes. But in general," 
           "according to the dataset dictionary, they are not metro areas or areas with to few charging stations. "
    ]),

    # 4b) Heatmap of top areas
    html.Div(className="media-wrapper", children=[
        html.Img(
            src="https://storage.googleapis.com/evenergy163.appspot.com/new_results/pacific_results/pacific_heatmap_top_areas.png",
            className="full-image"
        )
    ]),
    html.P(
        "(Info: Heatmap of usage over time.)",
        className="info-text"
    ),
    html.Div(className="findings-text", children=[
        "Summary: The heatmap shows us over time how much each location charging station usage is increasing or decreasing. "
           "Going down the y-axis, we can closer to the present, we can see the areas get more and more charging records. "
           "(Note): Portland-Vancouver-Hillsboro had an avg monthly growth rate of 3.17% for charging sessions, when comparing linear "
           "and exponential models, the exponential model had an r2 score of 0.858, while the linear model had an r2 score of 0.744. "
           "meaning the exponential model fitted better than the linear regression model. "
    ])

]),


    # 5) Overall summary
    html.Div(className="findings-section", children=[
        html.H3("Summary", className="subsection-title"),
        html.Div(className="findings-text", children=[
            "From these analysis and visualizations, we can see that both energy usage and charging "
           "sessions is increasing over time. We can see that energy usage is being consumed at almost "
           "exponential rate in the pacific region compared to linear overall in the USA. While focusing " 
           "on the Pacific region, we can see that the most popular charging locations are around Oregon and Washington. "
           "The next step now would be to analyze the difference between Electric and Gas, and predict future trends."
        ])
    ]),

])
